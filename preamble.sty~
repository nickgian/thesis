\usepackage{fontenc}[T1]

\usepackage[american]{babel}

% \usepackage{microtype}
\usepackage{amsmath,amssymb,amsthm}

\usepackage{aliascnt} %% using a single counter and still get autoref to work

\theoremstyle{definition}
\newtheorem{dummy}{***}[section] % [subsection] for within subsections
\newcommand{\mynewtheorem}[2]{
  \newaliascnt{#1}{dummy}
  \newtheorem{#1}[#1]{#2}
  \aliascntresetthe{#1}
  % maybe we will squish some autoref defaults, but who cares?
  \expandafter\def\csname #1autorefname\endcsname{#2}
}
\mynewtheorem{defn}{Definition}
\mynewtheorem{lemma}{Lemma}
\mynewtheorem{thm}{Theorem}
\mynewtheorem{cor}{Corollary}

% \usepackage{stmaryrd}
% \usepackage{supertabular}
% % \usepackage{fullpage}
\usepackage{ifthen}
\usepackage{ifmtarg}
\usepackage{xcolor}
\usepackage{xspace}
% \usepackage{listings}
% \usepackage{fancyvrb}
% \usepackage{bussproofs}
% \usepackage{mathpartir}
\usepackage{graphicx}
%% \usepackage{bcptheorem}
\usepackage{bcprules}
\setlength{\afterruleskip}{\medskipamount}
\usepackage{morefloats}
%% \setlength{\afterruleskip}{\medskipamount}
%\usepackage{fnpct} % adjacent footnotes, compatible with hyperref
                    % but not working on APT's machine
\usepackage[normalem]{ulem}
\usepackage[
    pdftex,%
    pdfpagelabels,%
    colorlinks,%
    linkcolor=blue,%
    citecolor=blue,%
    filecolor=blue,%
    urlcolor=blue%
\ifbackref,backref\fi%
]{hyperref}
\def\Snospace~{\S{}}
\addto\extrasamerican{% the addto needed to make babel happy
  \def\sectionautorefname{\Snospace}%
  \def\subsectionautorefname{\Snospace}%
  \def\subsubsectionautorefname{\Snospace}%
  \def\figureautorefname{Fig.}%
}
%% \newcommand*{\thmautorefname}{Theorem}  
%% \newcommand*{\defnautorefname}{Definition}  
%% \newcommand*{\lemmaautorefname}{Lemma}  

\usepackage{booktabs}
\usepackage{tabularx}
\newcolumntype{m}[1]{>{$}#1<{$}}

% Colors
\definecolor{dkblue}{rgb}{0,0.1,0.5}
\definecolor{dkgreen}{rgb}{0,0.4,0}
\definecolor{dkred}{rgb}{0.6,0,0}
\definecolor{dkpurple}{rgb}{0.7,0,0.4}
\definecolor{olive}{rgb}{0.5, 0.5, 0.0}
\definecolor{teal}{rgb}{0.0,0.5,0.5}

% Comments
\long\def\comment#1{}
\newcommand{\finish}[1]{\ifdraft\textcolor{gray}{[#1]}\fi}
\newcommand{\FINISH}[1]{\ifdraft\textcolor{blue}{[#1]}\fi}
\newcommand{\feedback}[1]{\ifdraft\textcolor{dkblue}{[#1]}\fi}
\newcommand{\review}[1]{\ifdraft\textcolor{dkblue}{[Review: #1]}\fi}

\newcommand{\estimate}[1]{\ifdraft{\color{red} [#1]}\fi}
\newcommand{\comm}[3]{\ifdraft{\color{#1}[#2: #3]}\fi}
\newcommand{\bcp}[1]{\comm{dkpurple}{BCP}{#1}}
\newcommand{\bcpNOW}[1]{\comm{dkpurple}{BCP}{\bf #1}}
\newcommand{\ch}[1]{\comm{dkgreen}{CH}{#1}} % Catalin
\newcommand{\chNOW}[1]{\comm{dkgreen}{CH}{\bf #1}} % Catalin
\newcommand{\dd}[1]{\comm{violet}{DD}{#1}} % Delphine
\newcommand{\apt}[1]{\comm{dkred}{APT}{#1}} % Andrew
\newcommand{\nc}[1]{\comm{orange}{NC}{#1}} % Nathan
\newcommand{\aaa}[1]{\comm{blue}{AAA}{#1}} % Arthur
\newcommand{\rap}[1]{\comm{magenta}{RAP}{#1}} % Randy
\newcommand{\amd}[1]{\comm{teal}{AMD}{#1}} % Andre
\newcommand{\jms}[1]{\comm{red}{JMS}{#1}} % JMS
\newcommand{\amdrev}[1]{{\color{teal}#1}} % Andre
\newcommand{\dpn}[1]{{\comm{olive}{DP}{#1}}} % David
\newcommand{\asz}[1]{{\comm{brown}{ASZ}{#1}}} % Antal
\newcommand{\reb}[1]{\comm{red}{Rebuttal}{#1}} % rebuttal
\newcommand{\gian}[1]{\comm{dkblue}{NG}{#1}} % Nick
\newcommand{\md}[1]{\comm{cyan}{MD}{#1}} % Maxime

% Horizontal brackets (from Andy G).                                    %
\newcommand{\hbra}{
  \hbox to \columnwidth{\vrule width0.3mm height 1.8mm depth-0.3mm
    \leaders\hrule height1.8mm depth-1.5mm\hfill
    \vrule width0.3mm height 1.8mm depth-0.3mm}}
\newcommand{\hket}{
  \hbox to \columnwidth{\vrule width0.3mm height1.5mm
    \leaders\hrule height0.3mm\hfill
    \vrule width0.3mm height1.5mm}}

\newcommand*{\EG}{e.g.,\xspace}
\newcommand*{\IE}{i.e.,\xspace}
\newcommand*{\ETAL}{{\em et al.}\xspace}
\newcommand*{\ETC}{etc.\xspace}

\newcommand*{\SAFE}{SAFE}

% OTT and LATEX macros for better granularity

\newcommand{\qaStep}[7]{%
\def\arraystretch{1}%
  \setlength\arraycolsep{2pt} \begin{array}{lrlc}%
    #1 & #2 & #3 & \xrightarrow{#4} \\
    #5 & #6 & #7 
\end{array}}

\newcommand{\aStep}[8]{%
\@ifmtarg{#8}{
    #1 \; #2 \; #3 \; \xrightarrow{#4} \; #5 \; #6 \; #7
  }{%
  \def\arraystretch{1}%
  \setlength\arraycolsep{2pt} \begin{array}{lrlc}%
    #1 & #2 & #3 & \xrightarrow{#4} \\
    #5 & #6 & #7 
  \end{array}%
  }
}

\newcommand{\cStep}[9]{%
  \def\ArgI{{#1}}%
  \def\ArgII{{#2}}%
  \def\ArgIII{{#3}}%
  \def\ArgIV{{#4}}%
  \def\ArgV{{#5}}%
  \def\ArgVI{{#6}}%
  \def\ArgVII{{#7}}%
  \def\ArgVIII{{#8}}%
  \def\ArgIX{{#9}}%
  \cStepContinue
}

\newcommand{\cStepContinue}[3]{%
  \def\ArgX{{#1}}%
  \def\ArgXI{{#2}}%
\@ifmtarg{#3}{
    \ArgI \; \ArgII \; \ArgIII \; \ArgIV \; \ArgV \xrightarrow{\ArgVI} \; \ArgVII \; \ArgVIII \; \ArgIX \; \ArgX \; \ArgXI
  }{%
  \def\arraystretch{1}%
  \setlength\arraycolsep{2pt}%
  \begin{array}{lclrlc}%
    \ArgI & \ArgII & \ArgIII & \ArgIV & \ArgV & \xrightarrow{\ArgVI} \\
    \ArgVII & \ArgVIII & \ArgIX & \ArgX & \ArgXI
  \end{array}%
  }%
}

\newcommand{\ceStep}[9]{%
  \def\ArgI{{#1}}%
  \def\ArgII{{#2}}%
  \def\ArgIII{{#3}}%
  \def\ArgIV{{#4}}%
  \def\ArgV{{#5}}%
  \def\ArgVI{{#6}}%
  \def\ArgVII{{#7}}%
  \def\ArgVIII{{#8}}%
  \def\ArgIX{{#9}}%
  \ceStepContinue
}

\newcommand{\ceStepContinue}[1]{%
\@ifmtarg{#1}{
    \ArgI \; \ArgII \; \ArgIII \; \ArgIV \xrightarrow{\ArgV} \; \ArgVI \; \ArgVII \; \ArgVIII \; \ArgIX
  }{%
  \def\arraystretch{1}%
  \setlength\arraycolsep{2pt}%
  \begin{array}{lclrc}%
    \ArgI & \ArgII & \ArgIII & \ArgIV & \xrightarrow{\ArgV} \\
    \ArgVI & \ArgVII & \ArgVIII & \ArgIX &
  \end{array}%
  }%
}

%% %%%% Reusing this tex black magic for runsToEscape
\newcommand{\privsteps}{\ensuremath \to_{\sf k}^{\star}}

\newcommand{\runsToEscape}[9]{%
  \def\ArgI{{#1}}%
  \def\ArgII{{#2}}%
  \def\ArgIII{{#3}}%
  \def\ArgIV{{#4}}%
  \def\ArgV{{#5}}%
  \def\ArgVI{{#6}}% % EVENT in Cstep
  \def\ArgVII{{#7}}%
  \def\ArgVIII{{#8}}%
  \def\ArgIX{{#9}}%
  \runsToEscapeContinue
}

\newcommand{\runsToEscapeContinue}[2]{%
  \def\ArgX{{#1}}%
\@ifmtarg{#2}{
    \ArgI \; \ArgII \; \ArgIII \; \ArgIV \; \ArgV \privsteps \ArgVI \; \ArgVII \; \ArgVIII \; \ArgIX \; \ArgX
  }{%
  \def\arraystretch{1}%
  \setlength\arraycolsep{2pt}%
  \begin{array}[t]{llclrlr}%
    \ArgI & \ArgII & \ArgIII & \ArgIV & \ArgV & \privsteps \\
    \ArgVI & \ArgVII & \ArgVIII & \ArgIX & \ArgX 
  \end{array}%
  }%
}

%% %%%% Reusing this tex black magic for runsToEnd
\newcommand{\runsToEnd}[9]{%
  \def\ArgI{{#1}}%
  \def\ArgII{{#2}}%
  \def\ArgIII{{#3}}%
  \def\ArgIV{{#4}}%
  \def\ArgV{{#5}}%
  \def\ArgVI{{#6}}% % EVENT in Cstep
  \def\ArgVII{{#7}}%
  \def\ArgVIII{{#8}}%
  \def\ArgIX{{#9}}%
  \runsToEndContinue
}

\newcommand{\runsToEndContinue}[2]{%
  \def\ArgX{{#1}}%
\@ifmtarg{#2}{
    \ArgI \; \ArgII \; \ArgIII \; \ArgIV \; \ArgV \privsteps \ArgVI \; \ArgVII \; \ArgVIII \; \ArgIX \; \ArgX
  }{%
  \def\arraystretch{1}%
  \setlength\arraycolsep{2pt}%
  \begin{array}{llclrlr}%
     \ArgI & \ArgII & \ArgIII & \ArgIV & \ArgV \privsteps \\
     \ArgVI & \ArgVII & \ArgVIII & \ArgIX & \ArgX
  \end{array}%
  }%
}

%%%% End of tex black magic

\newcommand{\ruleeval}[4]{ #1 \leadsto_{#2} #3 , #4 }
\newcommand{\concretefont}{\mathit}
\newcommand{\concretesymbol}{}

%%%%%%%

\newcommand{\lattHL}{\ensuremath \mathsf{HL}} % The 2 point-lattice

\newcommand{\esilent}{\tau} %CH: or better tau? DD: I prefer tau
\newcommand{\action}{\alpha}
\newcommand{\xrule}[2]{\frac{#1}{#2}}
\newcommand{\tnil}[0]{\ensuremath{\epsilon}} % or \bullet
\newcommand{\tcons}[2]{\ensuremath{#1 . #2}}
\newcommand{\stepr}[0]{\mathrel{\xrightarrow{.}}}
\newcommand{\rightarrownostar}[1]{\mathrel{\xrightarrow{#1}\mathrel{\vphantom{\to}}}}
\newcommand{\singlestep}[3]{#1 \rightarrownostar{#2} #3}
\newcommand{\rightarrowstar}[1]{\mathrel{\xrightarrow{#1}\mathrel{\vphantom{\to}^\star}}}
\newcommand{\multistep}[3]{#1 \rightarrowstar{#2} #3}
\newcommand{\ftrace}[2]{#1 \rightarrowstar{#2}}
\newcommand{\init}[1]{\ensuremath{\mathit{Init}(#1)}}
\newcommand{\initf}[0]{\ensuremath{\mathit{Init}}}
\newcommand{\Initf}[1]{\ensuremath{\initf(#1)}}
\newcommand{\match}{\triangleright}
\newcommand{\lift}[1]{\mathrel{[{#1}]}}
\newcommand{\Match}{\lift{\match}}
\newcommand{\Matchu}[1]{\lift{\match_{#1}}}
\newcommand{\Matchus}[2]{\lift{\match_{#1}^{#2}}}
\newcommand{\Matchut}[1]{\Matchus{#1}{\esilent}}
\newcommand{\Matcht}{\Matchut{}}
\newcommand{\rotatedown}[1]{\mathbin{\text{\rotatebox[origin=c]{-90}{$#1$}}}}
\newcommand{\length}[1]{\textsf{length}(#1)}
\newcommand{\removesilent}[1]{\filter{\esilent}{#1}}
\newcommand{\Implies}[2]{#1\;\Longrightarrow\;#2}
\newcommand{\Andip}{{\:\wedge\:}}
\newcommand{\privstate}[2]{\ensuremath #1^{#2} }
\newcommand{\filter}[2]{\ensuremath{\lfloor #2 \rfloor_{#1}}}
\newcommand{\eqnref}[1]{(\ref{#1})}

% Mysterious example found on the TeX Stack Exchange to draw a diagram
% with a reflexive-transitive closure.
\usepackage{tikz}
\usepgflibrary{plotmarks}
\tikzset{
    to*/.style={
        shorten >=.25em,#1-to,
        to path={-- node[inner sep=0pt,at end,sloped] {${}^*$} (\tikztotarget) \tikztonodes}
    },
    to*/.default=
}

\tikzset{
    tok*/.style={
        shorten >=.25em,#1-to,
        to path={-- node[inner sep=0pt,at end,sloped] {${}^\star_{\sf k}$} (\tikztotarget) \tikztonodes}
    },
    tok*/.default=
}

\makeatletter
\pgfarrowsdeclare{to*}{to*}
{
  \pgfutil@tempdima=-0.84pt%
  \advance\pgfutil@tempdima by-1.3\pgflinewidth%
  \pgfutil@tempdimb=0.21pt%
  \advance\pgfutil@tempdimb by.625\pgflinewidth%
  \advance\pgfutil@tempdimb by2.5pt%
  \pgfarrowsleftextend{+\pgfutil@tempdima}
  \pgfarrowsrightextend{+\pgfutil@tempdimb}
}
{
  \pgfutil@tempdima=0.28pt%
  \advance\pgfutil@tempdima by.3\pgflinewidth%
  \pgfsetlinewidth{0.8\pgflinewidth}
  \pgfsetdash{}{+0pt}
  \pgfsetroundcap
  \pgfsetroundjoin
  \pgfpathmoveto{\pgfqpoint{-3\pgfutil@tempdima}{4\pgfutil@tempdima}}
  \pgfpathcurveto
  {\pgfqpoint{-2.75\pgfutil@tempdima}{2.5\pgfutil@tempdima}}
  {\pgfqpoint{0pt}{0.25\pgfutil@tempdima}}
  {\pgfqpoint{0.75\pgfutil@tempdima}{0pt}}
  \pgfpathcurveto
  {\pgfqpoint{0pt}{-0.25\pgfutil@tempdima}}
  {\pgfqpoint{-2.75\pgfutil@tempdima}{-2.5\pgfutil@tempdima}}
  {\pgfqpoint{-3\pgfutil@tempdima}{-4\pgfutil@tempdima}}
  \pgfusepathqstroke
  \begingroup
    \pgftransformxshift{2.5pt}
    \pgftransformyshift{2pt}
    \pgftransformscale{.7}
    \pgfuseplotmark{asterisk}
  \endgroup
%  \pgftext[left,y=2pt]{$\scriptstyle *$}
}

\usetikzlibrary{calc}

\newcommand{\dummytag}{\underline{\hspace{.5em}}}

\newcommand{\citeEtcShort}[1]{\iffull\cite{#1}\else\cite[etc.]{#1}\fi}

\newcommand*{\ii}[1]{\textit{#1}}

\makeatletter
\newdimen\OPCODEwidth
\OPCODEwidth .5in
\newdimen\RULEwidth
\newcommand{\TRUE}{\text{\tt true}}
\newcommand{\RULE}[9]{
\gdef\RULEARROW{\ifthenelse{\equal{#7}{}}{\Rightarrow}{\rightarrow}}  % HACK!
\gdef\RULEINPUT{(#2,#3,#4,#5,#6)}
\gdef\RULEOUTPUT{(#8,#9)}
\gdef\RULECOND{%
  \ifthenelse{\equal{#7}{}}{}%
             {\ifthenelse{\equal{#7}{\TRUE}}{}%
                         {\mathrm{\;if\;}#7}}%
}
&& \hspace*{-18.5em}
  \hbox to 1in {
      \hbox to \OPCODEwidth {\ifx&#1&\else$#1$\ : \fi} 
      % See how big it is on one line
      \setbox \@tempboxa \hbox{$\RULEINPUT \RULEARROW \RULEOUTPUT \RULECOND$}
      \RULEwidth \wd\@tempboxa
      % Does it fit?
      \ifdim \RULEwidth < 2.4in
        % Use it
        \box\@tempboxa
      \else\ifdim \RULEwidth < 4.8in
        % Put it on two lines
        $ \hspace*{-1.3em}
        \begin{array}[t]{@{}l@{\ }l}
            & \RULEINPUT \\
            \RULEARROW
            & \RULEOUTPUT\RULECOND
        \end{array}
       $
      \else
        % Put it on three lines
        $ \hspace*{-1.3em}
        \begin{array}[t]{@{}l@{}l}
            & \ \RULEINPUT \\
            \RULEARROW
            & \ \RULEOUTPUT \\
            & \RULECOND
        \end{array}
       $
     \fi\fi
  }
}
\newcommand{\SAME}[1]{
&& \hspace*{-18.5em}
  \hbox to 1in {
      \hbox to \OPCODEwidth {$#1$\ : }
      \setbox \@tempboxa \hbox{~~~~~~~~~~~~~}
      \RULEwidth \wd\@tempboxa
      \box\@tempboxa\nonumber
}}
\newcommand{\ORULE}[9]{
	\gdef\RULEARROW{\ifthenelse{\equal{#7}{}}{\Rightarrow}{\xrightarrow{1}}}  % HACK!
\gdef\RULEINPUT{(#2,#3,#4,#5,#6)}
\gdef\RULEOUTPUT{%
       (#8,#9)%
       \ifthenelse{\equal{#7}{}}{}%
                   {\ifthenelse{\equal{#7}{\TRUE}}{}%
                               {\mathrm{\;if\;}#7}}}
&& \hspace*{-18.5em}
  \hbox to 1in {
      \hbox to \OPCODEwidth {$#1$\ : }
      % See how big it is on one line
      \setbox \@tempboxa \hbox{$\RULEINPUT \RULEARROW \RULEOUTPUT$}
      \RULEwidth \wd\@tempboxa
      % Does it fit?
      \ifdim \RULEwidth < 2.6in
        % Use it
        \box\@tempboxa
      \else
        % Put it on two lines
        $ \hspace*{-1.3em}
        \begin{array}[t]{@{}l@{\ }l}
            & \RULEINPUT \\
            \RULEARROW
            & \RULEOUTPUT
        \end{array}
       $
     \fi
  }
}
\newcommand{\CRULE}[8]{%
  \RULE{#1}{#2}{}{#3}{#4}{#5}{#6}{#7}{#8}
}
\makeatother

\newcommand{\mem}[0]{\ii{mem}}
\newcommand{\imem}[0]{\ii{im}}
\newcommand{\dmem}[0]{\ii{dm}}
\newcommand{\reg}[0]{\ii{reg}}
\newcommand{\rd}[2]{#1[#2]}
\newcommand{\upd}[3]{#1[#2{\leftarrow}#3]}
\newcommand{\pc}[0]{\ii{pc}}
\newcommand{\epc}[0]{\ii{epc}\xspace}
\newcommand{\ra}[0]{\ii{ra}}
\newcommand{\tpc}[0]{t_\ii{pc}}
\newcommand{\tra}[0]{t_\ii{ra}}
\newcommand{\ti}[0]{t_\ii{i}}
\newcommand{\ks}[0]{\ii{ks}}
\newcommand{\extra}[0]{\ii{extra}}
\newcommand{\TRANSFER}{\ii{transfer}\xspace}
\newcommand{\EXTRASTATES}{\ii{EX}}
\newcommand{\cache}{\ii{cache}}
\newcommand{\SK}{\ii{SK}}
\newcommand{\iv}{\ii{iv}}
\newcommand{\ov}{\ii{ov}}
\newcommand{\step}[2]{\ensuremath{#1\to#2}}
\newcommand{\stepn}[2]{\ensuremath{#1\to_n#2}}
\newcommand{\stepa}[2]{\ensuremath{#1\to_a#2}}
\newcommand{\longstep}[2]{\begin{array}[t]{l@{\;}l}&#1\\\to&#2\end{array}}
\newcommand{\astat}[4]{\ensuremath{(#1,#2,#3\ifthenelse{\equal{#4}{}}{}{,#4})}}
\newcommand{\acfistat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}
\newcommand{\cstat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}
\newcommand{\stat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}
\newcommand{\rret}{r_{\!\ii{ret}}}
\newcommand{\rarg}[1]{r_{\!\ii{arg#1}}}
\newcommand{\old}{_{\mathit{old}}}
\newcommand{\undefined}{\uparrow}
\newcommand{\trapaddr}{\ii{trapaddr}}
\newcommand{\handler}[8]{\ii{transfer}(#1,#2,#3,#4,#5,#6) = (#7,#8)}
\newcommand{\rulelookup}[8]{%
   \cache \vdash (#1,#2,#3,#4,#5,#6) \mapsto (#7,#8)}
\newcommand{\rulelookupshort}[2]{%
   \cache \vdash #1 \mapsto #2}
\newcommand{\rulelookupmissshort}[1]{%
   \cache \vdash #1 \uparrow}
\newcommand{\rulelookupmiss}[6]{%
   \cache \vdash (#1,#2,#3,#4,#5,#6) \uparrow}
\newcommand{\savestate}[7]{%
  #7 [0..5 \leftarrow ({#1},{#2},{#3},{#4},{#5},{#6})]}
\newcommand{\savestateshort}[2]{%
  #2 [0..5 \leftarrow {#1}]}
\newcommand{\mapupd}{\uplus}

\newcommand{\VData}[1]{#1}%\ii{VWord}~
\newcommand{\VKey}[1]{#1} % \ii{VKey}~
\newcommand{\VSealed}[2]{\{#1\}_{#2}}
\newcommand{\VPtr}[1]{#1}

\newcommand*{\Compartments}{C}
\newcommand*{\AddressSpace}{A}
\newcommand*{\JumpTargets}{J}
\newcommand*{\StoreTargets}{S} 
\newcommand*{\compartment}{c}
\newcommand*{\pointer}{p}
\newcommand*{\Ccompartment}{c}
\newcommand*{\CIncoming}{I}
\newcommand*{\CWriters}{W}
\newcommand*{\stepkind}{F}
\newcommand*{\Cpcstate}{F}
\newcommand*{\INTERNAL}{\ii{Internal}}
\newcommand*{\JUMPED}{\ii{Jumped}}
\newcommand*{\tPC}[2]{\langle#1,#2\rangle}
\newcommand*{\tDATA}[3]{\langle#1,#2,#3\rangle}
\newcommand*{\tREG}{\ii{Reg}}
\newcommand*{\tIsolate}{t_{\ii{I}}}
\newcommand*{\tAddJ}{t_{\ii{AJ}}}
\newcommand*{\tAddS}{t_{\ii{AS}}}

\newcommand{\DATA}[0]{\ii{Data}}
\newcommand{\KEYname}[0]{\ii{Key}}
\newcommand{\KEY}[1]{\KEYname~#1}
\newcommand{\SEALED}[1]{\ii{Sealed}~#1}
\newcommand{\INSTRname}[0]{\ii{Instr}}
\newcommand{\INSTR}[1]{\INSTRname~#1}

\newcommand{\USERname}[0]{\ii{User}}
\newcommand{\USER}[1]{\USERname~#1}
\newcommand{\MONITOR}[0]{\ii{Monitor}}
\newcommand{\ENTRYname}[0]{\ii{Entry}}
\newcommand{\ENTRY}[1]{\ENTRYname~#1}
\newcommand{\enc}[1]{\ii{enc}~#1}

\let\oldunderscore=\_
\def\_{\oldunderscore\hspace{1.5pt}}

\newenvironment{tightenumerate}{%
  \iffull
    \begin{enumerate}
  \else
    \begin{enumerate*}[label=(\arabic*)]
  \fi
}{
  \iffull
    \end{enumerate}
  \else
    \end{enumerate*}%
  \fi
}

\newenvironment{tightenumeratealpha}{%
  \iffull
    \begin{enumerate}
  \else
    \begin{enumerate*}[label=(\alph*\upshape)]
  \fi
}{
  \iffull
    \end{enumerate}
  \else
    \end{enumerate*}%
  \fi
}

\newcommand{\citeFull}[2]{\iffull\cite{#1,#2}\else\cite{#1}\fi}

\newcommand{\RULEWITHPREMISE}[9]{
\typicallabel{}
  \infrule{#7}{\ii{#1} : (#2, #3, #4, #5, #6) \to (#8,#9)}
\typicallabel{MkKey}
}
