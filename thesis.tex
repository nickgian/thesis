% DOCUMENT FORMAT ==============================================================

\newif\ifdraft  \drafttrue
\interfootnotelinepenalty=10000



\documentclass{ntua-thesis} % a4paper,11pt,twoside,titlepage already set
% \pagestyle{plain} % pagestyle already set
% \usepackage[margin=2.5cm]{geometry} % margins already set


% PACKAGE SETTINGS =============================================================

\usepackage[cm-default]{fontspec}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage{xspace}
\usepackage{url}
\usepackage{color}
\usepackage{bytefield}
\usepackage[format=hang,textformat=simple]{caption}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{bcprules}
\restylefloat{table}
\restylefloat{figure}
\usepackage[color]{coqdoc}
\usepackage{tabularx}
\newcolumntype{m}[1]{>{$}#1<{$}}
\usepackage{hyperref}
\hypersetup{%
    xetex,
    hyperfootnotes=true,
    colorlinks=true,
    pdfpagemode=UseOutlines,
    pdfstartview=FitH,
    linkcolor=dkblue,
    citecolor=blue,
    urlcolor=magenta,
    pdftitle={},
    pdfauthor={Nick Giannarakis},
    pdfsubject={},
    pdfkeywords={}
}


\setromanfont[Mapping=tex-text]{CMU Concrete Roman}
\setsansfont[Mapping=tex-text]{CMU Concrete Roman}
\setmonofont[Mapping=tex-text]{CMU Concrete Roman}
\setmainfont[Mapping=tex-text]{CMU Concrete Roman}


% CUSTOM COMMANDS ==============================================================

\newcommand{\flink}[1]{\footnote{\url{#1}}}
\newcommand{\subscript}[1]{\ensuremath{{\textrm{#1}}}}
\newenvironment{fulltable}[3]{
    \def\tempcaption{#2}
    \def\templabel{#3}
    \begin{table}[hbtp]
    \begin{center}
    \begin{tabular}[c]{#1}
}{
    \end{tabular}
    \end{center}
    \caption{\tempcaption\label{\templabel}}
    \end{table}
}
%macro που δίνει το μέγιστο επιτρεπτό μέγεθος σε μια εικόνα χωρίς να
%παραβιάζει τα όρια του LaTeX
\makeatletter
\def\maxwidth{%
  \ifdim\Gin@nat@width>\linewidth
  \linewidth
  \else
  \Gin@nat@width
  \fi
}

% Generic commands

\declaretheorem[numberwithin=chapter]{theorem}
\declaretheorem[sibling=theorem]{definition}
\declaretheorem[sibling=theorem]{lemma}

% \makeatletter
% \AtBeginDocument{%
%   \renewcommand*{\thetable}{\arabic{chapter}.\arabic{table}}
%   \renewcommand*{\thefigure}{\arabic{chapter}.\arabic{figure}}
%   \renewcommand*{\thelstlisting}{\arabic{chapter}.\arabic{lstlisting}}
%   \let\c@table\c@theorem
%   \let\c@table\c@figure
%   \let\c@table\c@lstlisting
%   \let\thetable\thefigure
%   \let\thetable\thelstlisting
%   \let\c@figure\c@lstlisting
%   \let\c@figure\c@theorem
%   \let\c@lstlisting\c@theorem
%   \let\thefigure\thelstlisting
%   \let\ftype@lstlisting\ftype@figure\ftype@table
%   % give the floats the same precedence
% }
% \makeatother

\makeatletter
  \renewcommand*{\thetable}{\arabic{chapter}.\arabic{table}}
  \renewcommand*{\thefigure}{\arabic{chapter}.\arabic{figure}}
\makeatother

\makeatletter
\AtBeginDocument{%
  \renewcommand*{\thelstlisting}{\arabic{chapter}.\arabic{lstlisting}}
}
\makeatother

\usepackage{cleveref}

\newcommand*{\EG}{e.g.,\xspace}
\newcommand*{\IE}{i.e.,\xspace}
\newcommand*{\ETAL}{{\em et al.}\xspace}
\newcommand*{\ETC}{etc.\xspace}

\newcommand{\TODO}[1]{(\textcolor{red}{\textbf{TODO:}}~#1)}

\definecolor{dkblue}{rgb}{0,0.1,0.5}
\definecolor{bluegreen}{rgb}{0,0.5,0.5}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{dkred}{rgb}{0.6,0,0}
\definecolor{dkpurple}{rgb}{0.7,0,0.4}
\definecolor{purple}{rgb}{0.7,0,0.7}
\definecolor{olive}{rgb}{0.5, 0.5, 0.0}
\definecolor{teal}{rgb}{0.0,0.5,0.5}



\newcommand{\ch}[1]{\ifdraft{\color{dkblue}\em (CH: #1)}\fi}
\newcommand{\nick}[1]{\ifdraft{\color{dkred}\em (NG: #1)}\fi}
\newcommand{\chfoot}[1]{\ifdraft\footnote{\color{dkblue}\em (CH: #1)}\fi}
\newcommand{\chrev}[1]{\ifdraft{\color{dkblue}#1}\else#1\fi}
\newcommand{\chlater}[1]{\iflater\ifdraft{\color{dkblue}\em (CH: #1)}\fi\fi}
\newcommand{\bcp}[1]{\ifdraft{\color{blue}\em (BCP: #1)}\fi}
\newcommand{\bcpfoot}[1]{\ifdraft\footnote{\color{blue}\em (BCP: #1)}\fi}
\newcommand{\bcprev}[1]{\ifdraft{\color{blue}\em #1}\else #1\fi}
\newcommand{\bcprevision}[1]{\ifdraft{\color{blue}\em (BCP: #1)}\fi}
\newcommand{\bcplater}[1]{\ifdraft\iflater{\color{blue}\em (BCP: #1)}\fi\fi}
\newcommand{\amd}[1]{\ifdraft{\color{purple}\em (AMD: #1)}\fi}
\newcommand{\amdrevision}[1]{\ifdraft{\color{purple} #1}\fi}
\newcommand{\ud}[1]{\ifdraft{\color{cyan}[UD -- #1]}\fi}
\newcommand{\udrev}[1]{\ifdraft{\color{cyan}#1}\else #1\fi}
\newcommand{\aaa}[1]{\ifdraft{\color{dkgreen}\em (AAA: #1)}\fi}

\newcommand*{\ii}[1]{\textit{#1}}

% Micro-policies related commands
\newcommand{\mem}[0]{\ii{mem}\xspace}
\newcommand{\imem}[0]{\ii{im}\xspace}
\newcommand{\dmem}[0]{\ii{dm}\xspace}
\newcommand{\reg}[0]{\ii{reg}\xspace}
\newcommand{\ok}[0]{\ii{ok}\xspace}
\newcommand{\rd}[2]{#1[#2]}
\newcommand{\upd}[3]{#1[#2{\leftarrow}#3]}
\newcommand{\pc}[0]{\ii{pc}\xspace}
\newcommand{\epc}[0]{\ii{epc}\xspace}
\newcommand{\PCname}[0]{\ii{pc}\xspace}
\newcommand{\EPCname}[0]{\ii{epc}\xspace}
\newcommand{\ra}[0]{\ii{ra}}
\newcommand{\tpc}[0]{t_\ii{pc}}
\newcommand{\tra}[0]{t_\ii{ra}}
\newcommand{\ti}[0]{t_\ii{i}}
\newcommand{\targ}[1]{t_\ii{#1}}
\newcommand{\extra}[0]{\ii{int}}
\newcommand{\TRANSFER}{\ii{transfer}\xspace}
\newcommand{\EXTRASTATES}{\ii{EX}}
\newcommand{\cache}{\ii{cache}\xspace}
\newcommand{\step}[2]{\ensuremath{#1\to#2}}
\newcommand{\stepn}[2]{\ensuremath{#1\to_n#2}}
\newcommand{\stepa}[3]{\ensuremath{#1\to_a^{#3}#2}}
\newcommand{\longstep}[2]{\begin{array}[t]{l@{\;}l}&#1\\\to&#2\end{array}}

\newcommand{\old}{_{\mathit{old}}}
 \newcommand{\trapaddr}{\ii{trapaddr}}
 \newcommand{\handler}[8]{\ii{transfer}(#1,#2,#3,#4,#5,#6) = (#7,#8)}
\newcommand{\rulelookup}[8]{%
   \cache \vdash (#1,#2,#3,#4,#5,#6) \mapsto (#7,#8)}
\newcommand{\rulelookupshort}[2]{%
   \cache \vdash #1 \mapsto #2}
\newcommand{\rulelookupmissshort}[1]{%
   \cache \vdash #1 \uparrow}
\newcommand{\rulelookupmiss}[6]{%
   \cache \vdash (#1,#2,#3,#4,#5,#6) \not \mapsto}
\newcommand{\savestate}[7]{%
  #7 [0..5 \leftarrow ({#1},{#2},{#3},{#4},{#5},{#6})]}
\newcommand{\savestateshort}[2]{%
  #2 [0..5 \leftarrow {#1}]}

\newcommand{\astat}[4]{\ensuremath{(#1,#2,#3,#4)}}
\newcommand{\acfistat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}
\newcommand{\cstat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}
\newcommand{\stat}[5]{\ensuremath{(#1,#2,#3,#4,#5)}}

\newcommand{\DATA}[0]{\ii{Data}}
\newcommand{\INSTRname}[0]{\ii{Code}\xspace}
\newcommand{\INSTR}[1]{\INSTRname~#1}
\newcommand{\DATAname}[0]{\ii{Data}\xspace}

\newcommand{\USERname}[0]{\ii{User}\xspace}
\newcommand{\USER}[1]{\USERname~#1}
\newcommand{\MONITOR}[0]{\ii{Monitor}\xspace}
\newcommand{\ENTRYname}[0]{\ii{Entry}\xspace}
\newcommand{\ENTRY}[1]{\ENTRYname~#1}
\newcommand{\enc}[1]{\ii{enc}~#1}
\newcommand{\atom}[2]{#1@#2}

\newcommand{\CFI}[0]{\emph{CFI}\xspace}
\newcommand{\CFG}[0]{$\mathcal{CFG}$\xspace}
\newcommand{\CFGm}[0]{\mathcal{CFG}\xspace}
\newcommand{\J}[0]{$\mathcal{J}$\xspace}
\newcommand{\Jm}[0]{\mathcal{J}\xspace}
\newcommand{\SUCC}[1]{$\mathcal{SUCC_\CFGm^{#1}}$\xspace}
\newcommand{\SUCCm}[1]{\mathcal{SUCC_\CFGm^{#1}}\xspace}

\newcommand{\INITIAL}[1]{\textit{initial~#1}\xspace}

\newcommand{\frule}[8]{#1:\{\ifthenelse{\equal{#2}{}}{}{PC{=}#2\ifthenelse{\equal{#3}{}}{}{,}}
                           \ifthenelse{\equal{#3}{}}{}{CI{=}#3}\ifthenelse{\equal{#4}{}}{}{,}
                           \ifthenelse{\equal{#4}{}}{}{OP1{=}#4}\ifthenelse{\equal{#5}{}}{}{,}
                           \ifthenelse{\equal{#5}{}}{}{OP2{=}#5}\ifthenelse{\equal{#6}{}}{}{,}
                           \ifthenelse{\equal{#6}{}}{}{MR{=}#6}
                           \} \to \{PC'{=}#7, RES{=}#8\}} 

\newcommand{\NXD}[0]{\emph{NXD}\xspace}
\newcommand{\NWC}[0]{\emph{NWC}\xspace}

\newcommand{\MARK}[0]{\emph{Marked}}
\newcommand{\UNMARK}[0]{\emph{Unmarked}}

\newcommand{\MARKname}[0]{\emph{Marked} \xspace}
\newcommand{\UNMARKname}[0]{\emph{Unmarked} \xspace}

\newcommand{\TAGS}[1]{$\mathcal{T} = \lbrace #1 \rbrace$}
\newcommand{\id}[0]{\ii{id}\xspace}
\newcommand{\word}[0]{\ii{word}\xspace}

\newcommand{\init}[1]{\ensuremath{\mathit{Init}(#1)}}
\newcommand{\initf}[0]{\ensuremath{\mathit{Init}}}
\newcommand{\Initf}[1]{\ensuremath{\initf(#1)}}

%TIKZ

% Mysterious example found on the TeX Stack Exchange to draw a diagram
% with a reflexive-transitive closure.
\usepackage{tikz}
\usepgflibrary{plotmarks}
\usetikzlibrary{matrix,arrows,decorations.pathmorphing,positioning,backgrounds,fit} 

\tikzset{snake it/.style={decorate, decoration=snake}}

\usetikzlibrary{calc}



% CODE HIGHLIGHTING ============================================================

% CODE HIGHLIGHTING ============================================================

\usepackage{lstcoq}
\definecolor{ForestGreen}{RGB}{0, 155, 85}
\definecolor{Purple}{RGB}{153, 71, 155}
\definecolor{BrickRed}{RGB}{182, 50, 28}
\definecolor{darkgreen}{cmyk}{0.7, 0, 1, 0.5}

\lstset{%
    numbers=none,
    numberstyle=\tiny\color[rgb]{0.5,0.5,0.5},
    basicstyle=\ttfamily\footnotesize,
    basewidth=0.59em,
    keywordstyle=[3]{},
    commentstyle=\itshape\footnotesize,
    tabsize=4,
    frame=single,
    frameround=tttt,
    showstringspaces=false,
    breaklines=false,
    captionpos=b,
    aboveskip=\bigskipamount,
    belowskip=\bigskipamount,
    escapechar=^,
    keywordstyle=\color[rgb]{0,0,1},
    commentstyle=\color[rgb]{0.133,0.545,0.133},
    stringstyle=\color[rgb]{0.627,0.126,0.941}
}

\newcommand\code[1]{{\tt\small #1}}
\newcommand\regex{\coqe{regex}}
\newcommand\dk{\coqe{decide_kleene}}

% Style options:
% numberstyle,basicstyle,identifierstyle,commentstyle,stringstyle
% keywordstyle=[1]{},keywordstyle=[2]{},directivestyle
% \small\tiny\footnotesize\itshape\ttfamily\bf
\lstdefinestyle{coq_style}{%
  language=Coq, float=htb!
}
\lstnewenvironment{Coq}[2]{%
  \nopagebreak
  \lstset{style=coq_style,label={#1},caption={#2}}
}{}

\newcommand{\includecode}[4][Coq]{%
  \nopagebreak
  \lstinputlisting[label={#2},caption={#3},style={#1_style}]{#4}
}
\newcommand{\lstheader}[2]{%
  \begin{lstlisting}[label={#1},caption={#2},style=coq_style]
}

% DOCUMENT INFORMATION =========================================================

%\title{}
\title{Formally Verified Tag-Based Enforcement of\\Control Flow Integrity}
% Monitor, Mechanism -- too low level
% Formally Verified Tag-Based Control Flow Integrity Enforcement
\author{Νικόλαος Γιανναράκης}
\thesis[του]{Νικόλαου Γιανναράκη}
\presenting{11}{9}{2014}
\supervisor[Αν. Καθηγητής ]{Νικόλαος Παπασπύρου} % the space is necessary
\epitropiF[Αν. Καθηγητής ]{Κωστής Σαγώνας}
\epitropiS[Αν. Καθηγητής  ]{Ιώαννης Σμαραγδάκης}
\department{Σχολή Ηλεκτρολόγων Μηχανικών και Μηχανικών Υπολογιστών}
\division{Τομέας Τεχνολογίας Πληροφορικής και Υπολογιστών}
\lab{Εργαστήριο Τεχνολογίας Λογισμικού}


% MAIN DOCUMENT ================================================================

\begin{document}

% \frontmatter
\maketitle
\def\templen{\parindent}
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.5ex plus 0.5ex minus 0.2ex}
\include{abstract}
\setlength{\parindent}{\templen}
\tableofcontents
\listoffigures
\renewcommand{\lstlistlistingname}{List of Listings}
\lstlistoflistings
\renewcommand{\listtheoremname}{List of theorems and definitions}
\listoftheorems[ignoreall,show={definition,lemma,theorem}]


% \mainmatter
% moved these two commands here so that they don't influence the toc
\setlength{\parindent}{12pt}
\setlength{\parskip}{0.5pt}
\include{chapter1}
\include{chapter2}
\include{chapter3}
\include{chapter4}
\include{conclusion}

% \backmatter
\cleardoublepage % start at the next odd page
\phantomsection % correct hyperlinking
\addcontentsline{toc}{chapter}{\bibname} % add bibliography section to toc
\bibliography{bibliography,safe,local}
\bibliographystyle{abbrv} % plain/abbrv/alpha/abstract/apalike/...
% \include{glossary}

\appendix
\chapter{Stuff}
\include{appendix}

% \printindex

\end{document}
